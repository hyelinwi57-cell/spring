<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.joonzis.mapper.BoardMapper">
	<select id="getList" 
         resultType="org.joonzis.domain.BoardVO"
         parameterType="org.joonzis.domain.Criteria">
      <![CDATA[
         SELECT bno, title, content, writer, regdate, updatedate, replycnt
         FROM (
             SELECT rownum rn, a.*
             FROM (
                 SELECT bno, title, content, writer, regdate, updatedate,replycnt
                 FROM tbl_board
                 ORDER BY bno DESC
             ) a
             WHERE rownum <= #{pageNum} * #{amount}
         )
         WHERE rn > (#{pageNum} - 1) * #{amount}
      ]]>
   </select>
   
   <select id="getNextBno" resultType="int">
		SELECT seq_board.CURRVAL FROM dual<!--CURRVAL: 현재값  -->
	</select>
	
	<insert id="insert" parameterType="org.joonzis.domain.BoardVO">
		INSERT INTO TBL_BOARD(bno, title, content, writer, regdate) 
		VALUES(
			seq_board.nextval,
			#{title}, 
			#{content}, 
			#{writer},
			sysdate
			
		)
	</insert>
	<select id="read" parameterType="int" resultType="org.joonzis.domain.BoardVO">
		SELECT * 
		FROM TBL_BOARD 
		WHERE bno = #{bno}
	</select>
	<delete id="delete" parameterType="int">
		DELETE
		FROM TBL_BOARD
		WHERE bno = #{bno}
	</delete>
	<update id="update" parameterType="org.joonzis.domain.BoardVO">
		UPDATE TBL_BOARD
		SET
			title= #{title},
			content= #{content},
			writer= #{writer},
			updatedate = sysdate
		WHERE 
			bno = #{bno}
	</update>
	<select id="getTotal" resultType="int">
		select count(*) from tbl_board
	</select>
	<update id="updateReplyCnt">
		UPDATE TBL_BOARD
		SET
			replycnt = replycnt + #{amount}
		WHERE bno = #{bno}	
	</update>
	
	
	
</mapper>
